\section{Hiding sets of features}
\label{sec:stat:hidMain}

The probability of a single feature in a software product line
is a measure of the occurrences of this feature in the set of
products. For instance, in case of testing, it is interesting to know
the most frequent components to focus our analysis on these components.
%Let us remark that this probability is affected by the dependencies and restrictions of
%the feature.
%
In order to compute the probability of a set of features, other features from the software product line are
\emph{hidden}. We hide features because it is usually not feasible to compute all the
products of the software product line. However, we expect to achieve our goal if we restrict ourselves to a subset of features. Thus,
non interesting features are transformed into a new feature,
denoted by $\bot\not\in\calF$, and we consider the set $\calFbot =
\calF\cup\{\bot\}$.

\begin{figure}[t]
        \linefigure

  \centering
\begin{displaymath}
    \begin{array}{ccccc}
      \nombreRegla{hid1} &
      \frac{P\tran{\fA}_p P', \fA\in\calA}{P\hide{\calA}\tran{\bot}_p P'\hide{\calA}} &
      \qquad \qquad \qquad&
      \nombreRegla{hid2} &
        \frac{P\tran{\fA}_p P', \fA\not\in\calA}{P\hide{\calA}\tran{\fA}_p P'\hide{\calA}}
    \end{array}
  \end{displaymath}
        \linefigure

  \caption{Operational semantics for the hiding operator}
  \label{fig:oper-hid}
\end{figure}



We extend the set of operators with a new one: hiding a set of
features in a term.

\bdfn
  Let $\calA\subseteq \calF$ be a subset of features and
  $P\in\fodaPAp$ be a term. We have that
   $P\hide{\calA}$ denotes the
  hiding of the features in $\calA$
  for the term $P$.
\edfn

We need to define the semantics of the new operator. The
operational semantics is given by the rules appearing in
Figure~\ref{fig:oper-hid}.
%
In order to define the denotational semantics of the new operator,
first we need an auxiliary function that hides some features
of a given product.

\bdfn
  Let $pr\subseteq\calF$ be a product and $\calA\subseteq\calF$
  be a set of features. The \emph{hiding of the set $\calA$
    in $pr$}, denoted by $pr\hide{\calA}$, is defined as follows:
  \begin{displaymath}
    pr\hide{\calA} = \{\fA\ |\ \fA\in pr\wedge
    \fA\not\in\calA\}\cup
    \begin{cases}
      \{\bot\} & \mbox{if } pr\cap\calA\neq\emptyset\\
      \emptyset & \mbox{if } pr\cap\calA=\emptyset\\
    \end{cases}
  \end{displaymath}

  Analogously, for any sequence $s\in\calF^{*}$ we consider that $s\hide\calA$ denotes the
  trace produced from $s$ after replacing all the occurrences of features belonging to $\calA$ by the symbol~$\bot$ in~$s$.
\edfn

\bdfn
  Let $M\in\calM$ and $\calA\subseteq\calF$. We define:
  \begin{displaymath}
    \semdenp{\cdot\hide{\calA}}(M) = \accum\Bigl(\lbag(pr\hide{\calA},p)\
    |\ (pr,p)\in M\rbag \Bigr)
  \end{displaymath}
\edfn

Finally, we have to prove that the
operational semantics and the denotational semantics are consistent.
%
The proof of the following result is an immediate consequence of Proposition~\ref{prop:hid1} (see Appendix~\ref{proof:prop:hid}).
%This is proven by the next result.

\bprop\label{prop:hid}Let $\calA\subseteq \calF$ be a subset of features and
  $P\in\fodaPAp$ be a term. We have $ \prodp(P\hideA)  =
  \semdenp{\prodp(P)\hideA}$.
  \begin{proof}
    The proof of this proposition is in Appendix~\ref{proof:prop:hid}.
  \end{proof}
\eprop

As usual in process algebras, it would be desirable that the hiding operator is \emph{derived}, that is, given a syntactic term, there exists a semantically equivalent term without occurrences of the hiding operator.
The idea is to substitute any occurrence of
the hidden actions by the symbol $\bot$. However, it is necessary to take into account  that we cannot
hide actions that appear in the restriction operators and, therefore, these cases are not contemplated.

\bprop
  Let $P,Q\in\fodaPAp$ be terms, $r\in (0,1]$ be a probability, and
  $\calA\subseteq\calF$ be a set of hidden actions. We have the following results:
  $$\begin{array}{rll}
  \semdenp{\cdot\hide\calA}(\semdenp{\checkmark})&=&\semdenp{\checkmark}\\[0.5em]
  \semdenp{\cdot\hide\calA}(\semdenp{\nil})&=&\semdenp{\nil}\\[0.5em]
  \semdenp{\cdot\hide\calA}(\semdenp{\fA;P})&=&
      \begin{cases}
        \semdenp{\bot;(P\hide\calA)} & \mbox{if } A\in\calA\\
        \semdenp{\fA;(P\hide\calA)} & \mbox{if } A\not\in\calA\\
      \end{cases}\\[1em]
  \semdenp{\cdot\hide\calA}(\semdenp{\ofA;_rP})&=&
      \begin{cases}
        \semdenp{\overline{\bot};_r(P\hide\calA)} & \mbox{if } A\in\calA\\
        \semdenp{\ofA;_r(P\hide\calA)} & \mbox{if } A\not\in\calA\\
      \end{cases}\\[1em]
  \semdenp{\cdot\hide\calA}(\semdenp{P\choice_P Q})&=&\semdenp{(P\hide\calA)\choice_P (Q\hide\calA)}\\[0.5em]
  \semdenp{\cdot\hide\calA}(\semdenp{P\paral Q})&=&\semdenp{(P\hide\calA)\paral (Q\hide\calA)}\\[0.5em]
  \mathrm{If\ } \fA,\fB\not\in\calA \mathrm{\ then\ }
    \semdenp{\cdot\hide\calA}(\semdenp{\require{A}{B}{P}})&=&\semdenp{\require{A}{B}{(P\hide\calA)}}\\[0.5em]
  \mathrm{If\ } \fA,\fB\not\in\calA \mathrm{\ then\ }
    \semdenp{\cdot\hide\calA}(\semdenp{\exclude{B}{P}})&=&\semdenp{\exclude{A}{B}{(P\hide\calA)}}
  \end{array}$$
%\mncomment{Luis, faltan casos, no? Que ocurre si $A$ y/o $B$
%  pertenecen al conjunto ocultado en los dos ultimos
%  items??}\lcomen{Efectivamente no es completo y no pretende
%  serlo. Está dicho en el párrafo anterior, cuando queremos calcular
%  la probabilidad de una (o un
%  conjunto) feature, debemos añadir sus dependencias y
%  restricciones.}
  \begin{proof}
    The proof is immediate applying the definitions and
   Proposition~\ref{prop:hid}.
 \end{proof}
\eprop


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
