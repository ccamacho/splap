%\subsection{Operational Semantics}
%\label{sec:stat:oper}


\begin{figure*}[h]
        \linefigure

        \centering\scalebox{0.95}{%
        $
        \begin{array}{*{3}{l@{}c@{\hspace{4em}}}}
        \nombreRegla{tick} & \checkmark\tranp{\checkmark}{1}\nil &
        \nombreRegla{feat} & \feature{A};P\tranp{\feature{A}}{1}P \\
        \nombreRegla{ofeat1} & \ofeature{A};_{p}P\tranp{\feature{A}}{p}P &
        \nombreRegla{ofeat2} & \ofeature{A};_{p}P\tranp{\checkmark}{(1-p)}\nil\\
        \nombreRegla{cho1} & \displaystyle \frac{P\tranp{\feature{A}}{p} P_1}{P\choice_{q} Q\tranp{\feature{A}}{p\cdot q} P_1}&
        \nombreRegla{cho2} & \displaystyle\frac{Q\tranp{\feature{A}}{q} Q_1}{P\choice_{p} Q\tranp{\feature{A}}{(1-p)\cdot q}Q_1}\\
        \nombreRegla{con1} & \displaystyle\frac{P\tranp{\feature{A}}{p} P_1}{P\paral Q\tranp{\feature{A}}{\frac{p}{2}}P_1\paral Q} &
        \nombreRegla{con2} & \displaystyle\frac{Q\tranp{\feature{A}}{q} Q_1}{P\paral Q\tranp{\feature{A}}{\frac{q}{2}}P\paral Q_1}\\
        \nombreRegla{con3} & \displaystyle\frac{P\tranp{\checkmark}{q}\nil, Q\tranp{\checkmark}{p}\nil}{P\paral Q\tranp{\checkmark}{p\cdot q}\nil} &\\
        \nombreRegla{con4} & \displaystyle\frac{P\tranp{\feature{A}}{p} P_1, Q\tranp{\checkmark}{q}\nil}{P\paral Q\tranp{\feature{A}}{\frac{p\cdot q}{2}} P_1} &
        \nombreRegla{con5} & \displaystyle\frac{P\tranp{\checkmark}{p}\nil,Q\tranp{\feature{A}}{q} Q_1}{P\paral Q\tranp{\feature{A}}{\frac{p\cdot q}{2}} Q_1} \\
        %
        %
        \nombreRegla{req1} & \displaystyle
        \frac{P \tranp{\feature{C}}{p} P_1,\ \feature{C}\neq\feature{A}}{\require{A}{B}{P}
                \tranp{\feature{C}}{p} \require{A}{B}{P_1}} &
        \nombreRegla{req2} &  \displaystyle
        \frac{P \tranp{\feature{A}}{p} P_1}{\require{A}{B}{P}\tranp{\feature{A}}{p} \mandatory{B}{P_1}} & \\
        % \nombreRegla{req3} & \displaystyle
        % \frac{P \tranp{\feature{B}}{p} P_1}{\require{A}{B}{P}
        %   \tranp{\feature{B}}{p} P_1} &
        \nombreRegla{req3} &  \displaystyle
        \frac{P \tranp{\feature{\checkmark}}{p} \nil}{\require{A}{B}{P}
                \tranp{\feature{\checkmark}}{p} \nil}\\
        \nombreRegla{excl1} &    \displaystyle
        \frac{P \tranp{\feature{C}}{p} P_1,\ \feature{C}\neq\feature{A},\  \feature{C}\neq\feature{B}}{
                \exclude{A}{B}{P}\tranp{\feature{C}}{p} \exclude{A}{B}{P_1}} &
        \nombreRegla{excl2} & \displaystyle
        \frac{P \tranp{\feature{A}}{p} P_1}{\exclude{A}{B}{P}
                \tranp{\feature{A}}{p}\forbid{B}{P_1}} \\
        \nombreRegla{excl3} & \displaystyle
        \frac{P \tranp{\feature{B}}{p} P_1}{\exclude{A}{B}{P}\tranp{\feature{B}}{p}\forbid{A}{P_1}}
        &
        \nombreRegla{excl4} & \displaystyle
        \frac{P \tranp{\checkmark}{p} \nil}{\exclude{A}{B}{P}\tranp{\checkmark}{p}\nil}\\

        \nombreRegla{forb1} & \displaystyle
        \frac{P \tranp{\feature{B}}{p} P_1,\ \feature{B}\neq\feature{A}}{\forbid{A}{P}
                \tranp{\feature{B}}{p} \forbid{A}{P_1}} &
        \nombreRegla{forb2} & \displaystyle
        \frac{P \tranp{\checkmark}{p} \nil}{\forbid{A}{P}
                \tranp{\checkmark}{p} \nil}  \\
        %      \nombreRegla{forb3} & \displaystyle
        %     \frac{P\tran{\feature{A}}P_2 \tran{\feature{F}} P_1}{\forbid{A}{P}
        %       \tran{\feature{B}} \forbid{A}{P_1}},\ \feature{B}\neq\feature{A} &
        %      \nombreRegla{forb4} & \displaystyle
        %     \frac{P\tran{\feature{A}}P_2 \tran{\feature{\checkmark}} P_1}{\forbid{A}{P}
        %       \tran{\checkmark} \nil}\\
        %
        %
        %
        \nombreRegla{mand1} &  \displaystyle\frac{P\tranp{\checkmark}{p} \nil}{\mandatory{A}{P}
                \tranp{\feature{A}}{p} \checkmark}  &
        \nombreRegla{mand2} &  \displaystyle\frac{P\tranp{\feature{A}}p P_1}{\mandatory{A}{P}\tranp{\feature{A}}p P_1} \\
        \nombreRegla{mand3} &  \displaystyle\frac{P\tranp{\feature{B}}p
                P_1,\ \feature{A}\neq\feature{B}}{\mandatory{A}{P}\tranp{\feature{B}}p \mandatory{A}{P_1}}
        \\
        \multicolumn{4}{c}{\feature{A},\feature{B},\feature{C}\in\calF,\ a\in\calF\cup\{\checkmark\}}

        \end{array}
        $}

        \noindent

        \linefigure

        \caption{\fodaPAp\ operational semantics.  \label{fig:sos-rules}}
\end{figure*}

\mncomment{No he leido la semantica operacional con cuidado: confio en Luis :-)}
%
In Figure~\ref{fig:sos-rules} we present the set of rules formally defining  the operational behavior of
\fodaPAp. These rules essentially coincide with the ones corresponding
\fodaPA~\cite{acl13}, but with the addition of probabilities. Next we focus 
on the explanation of the role of probabilities. Rules
$\nombreRegla{tick}$ and $\nombreRegla{feat}$
show the corresponding feature with probability 1.
%
Rules  $\nombreRegla{ofeat1}$ and $\nombreRegla{ofeat2}$ deal with the
probabilistic optional feature. The feature can be chosen with probability
$p$ and can be rejected with probability  $1-p$. Let us note that both probabilities
are not null.
%
Rules $\nombreRegla{cho1}$ and $\nombreRegla{cho2}$ define the
behavior of the probabilistic choice operator. The left branch is
selected with probability $p$ and the right with probability $1-p$.
%
It is important to note rules for the conjunction operator
(Rules $\nombreRegla{con1}$ to $\nombreRegla{con4}$)
distribute the probability equitably between both
branches, that is, $\frac{1}{2}$. We have preferred to use a simple definition of this operator, but it is easy to replace it by a more involved version of a probabilistic parallel operator~\cite{ahk98}.
%
Rule $\nombreRegla{con5}$ requires that both branches agree on the
termination of a product.
%
We use \emph{multisets} of transitions to consider different occurrences of the same transition. So, if a transition can be derived in several ways, each derivation generates a different
instance of this transition. For example, let us consider the
term
$P=\ofeature{A} \choice_{\frac12} \ofeature{A}$, where trailing occurrences of
$\nil$ have been omitted. If we were not careful, we would have
the transition $P\tranp{\feature{A}}{\frac12}\nil$ only once, while we
should have this transition twice. So, if a transition can be derived in
several ways, we consider that each derivation generates a
different instance. In particular, we will later consider multisets of computations as well.
%
We will use the delimiters~$\lbag$ and~$\rbag$ to denote
multisets.

The following result, the proof is immediate, show that successful termination leads to $\nil$.
\mncomment{Esto pa que sirve? Es obvio, no?}

\blem\label{lem:check}
Let $P,Q\in\fodaPAp$ and $p\in(0,1]$. We have $P\tranp{\checkmark}{p}{Q}$ if and only if $Q=\nil$.
\elem

Next we present some notions associated with the composition of consecutive transitions. 

\bdfn\label{def:trtrantions} Let $P,Q\in\fodaPAp$. We write  $P\vtranp{s}{p}Q$ if there exist a sequence of consecutive transitions
\begin{displaymath}
    P=P_0\tranp{a_1}{p_1}P_1\tranp{a_2}{p_2}P_2\cdots P_{n-1}\tranp{a_n}{p_n} P_n=Q
\end{displaymath}
where $n\geq 0$, $s=a_1a_2\cdots a_n$ and $p=p_1\cdot p_2\cdot \cdots p_{n}$.

Let $P\in\fodaPAp$. We define the set of probabilistic products of $P$, denoted by $\prodp(P)$, as the set
\begin{displaymath}
\{(pr,p)\ |\ p>0 \wedge p=\sum\lbag q\ |\
  P\vtranp{s\checkmark}{q} Q \y \product{s}=pr \rbag\}
\end{displaymath}
\item We define the total probability of $P$, denote by $\ham(P)$, as \rbag p\ |\ \exists pr: (pr,p)\in\prodp(P)$. In addition, we define $\waste(P) = 1-\ham(P)$.
\edfn


\begin{itemize}
\item Si tengo una traza su probabilidad es mayor que 0.
\item La suma de las probabilidades de todos los productos est√°n en el
  intervalo [0,1].
\end{itemize}



\blem\label{lem:sum:prob}
  Let  $P,\ Q\in\fodaPAp$,
  \begin{enumerate}
  \item $P\tranp{\feature{A}}{p}Q$ then $p\in(0,1]$.
  \item $P\vtranp{s}{p}Q$ then $p\in(0,1]$.
  \item
    $\sum \lbag p\, |\ \exists \feature{A}\in\calF,\ Q\in\fodaPA:\
    P\tranp{\feature{A}}{p}Q \rbag\in[0,1]$

  \item
    $\sum \lbag p\, |\ \exists \feature{s}\in\calF^*,\ Q\in\fodaPA:\
    P\tranp{\feature{s}}{p}Q \rbag\in[0,1]$
  \item
    $\ham(P)\in [0,1]$
  \end{enumerate}
\elem





%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
