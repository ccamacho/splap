%\subsection{Operational Semantics}
%\label{sec:stat:oper}


\begin{figure*}[t]
        \linefigure

        \centering\scalebox{0.95}{%
        $
        \begin{array}{*{3}{l@{}c@{\hspace{4em}}}}
        \nombreRegla{tick} & \checkmark\tranp{\checkmark}{1}\nil &
        \nombreRegla{feat} & \feature{A};P\tranp{\feature{A}}{1}P \\
        \nombreRegla{ofeat1} & \ofeature{A};_{p}P\tranp{\feature{A}}{p}P &
        \nombreRegla{ofeat2} & \ofeature{A};_{p}P\tranp{\checkmark}{(1-p)}\nil\\
        \nombreRegla{cho1} & \displaystyle \frac{P\tranp{\feature{A}}{p} P_1}{P\choice_{q} Q\tranp{\feature{A}}{p\cdot q} P_1}&
        \nombreRegla{cho2} & \displaystyle\frac{Q\tranp{\feature{A}}{q} Q_1}{P\choice_{p} Q\tranp{\feature{A}}{(1-p)\cdot q}Q_1}\\
        \nombreRegla{con1} & \displaystyle\frac{P\tranp{\feature{A}}{p} P_1}{P\paral Q\tranp{\feature{A}}{\frac{p}{2}}P_1\paral Q} &
        \nombreRegla{con2} & \displaystyle\frac{Q\tranp{\feature{A}}{q} Q_1}{P\paral Q\tranp{\feature{A}}{\frac{q}{2}}P\paral Q_1}\\
        \nombreRegla{con3} & \displaystyle\frac{P\tranp{\checkmark}{q}\nil, Q\tranp{\checkmark}{p}\nil}{P\paral Q\tranp{\checkmark}{p\cdot q}\nil} &\\
        \nombreRegla{con4} & \displaystyle\frac{P\tranp{\feature{A}}{p} P_1, Q\tranp{\checkmark}{q}\nil}{P\paral Q\tranp{\feature{A}}{\frac{p\cdot q}{2}} P_1} &
        \nombreRegla{con5} & \displaystyle\frac{P\tranp{\checkmark}{p}\nil,Q\tranp{\feature{A}}{q} Q_1}{P\paral Q\tranp{\feature{A}}{\frac{p\cdot q}{2}} Q_1} \\
        %
        %
        \nombreRegla{req1} & \displaystyle
        \frac{P \tranp{\feature{C}}{p} P_1,\ \feature{C}\neq\feature{A}}{\require{A}{B}{P}
                \tranp{\feature{C}}{p} \require{A}{B}{P_1}} &
        \nombreRegla{req2} &  \displaystyle
        \frac{P \tranp{\feature{A}}{p} P_1}{\require{A}{B}{P}\tranp{\feature{A}}{p} \mandatory{B}{P_1}} & \\
        % \nombreRegla{req3} & \displaystyle
        % \frac{P \tranp{\feature{B}}{p} P_1}{\require{A}{B}{P}
        %   \tranp{\feature{B}}{p} P_1} &
        \nombreRegla{req3} &  \displaystyle
        \frac{P \tranp{\feature{\checkmark}}{p} \nil}{\require{A}{B}{P}
                \tranp{\feature{\checkmark}}{p} \nil}\\
        \nombreRegla{excl1} &    \displaystyle
        \frac{P \tranp{\feature{C}}{p} P_1,\ \feature{C}\neq\feature{A},\  \feature{C}\neq\feature{B}}{
                \exclude{A}{B}{P}\tranp{\feature{C}}{p} \exclude{A}{B}{P_1}} &
        \nombreRegla{excl2} & \displaystyle
        \frac{P \tranp{\feature{A}}{p} P_1}{\exclude{A}{B}{P}
                \tranp{\feature{A}}{p}\forbid{B}{P_1}} \\
        \nombreRegla{excl3} & \displaystyle
        \frac{P \tranp{\feature{B}}{p} P_1}{\exclude{A}{B}{P}\tranp{\feature{B}}{p}\forbid{A}{P_1}}
        &
        \nombreRegla{excl4} & \displaystyle
        \frac{P \tranp{\checkmark}{p} \nil}{\exclude{A}{B}{P}\tranp{\checkmark}{p}\nil}\\

        \nombreRegla{forb1} & \displaystyle
        \frac{P \tranp{\feature{B}}{p} P_1,\ \feature{B}\neq\feature{A}}{\forbid{A}{P}
                \tranp{\feature{B}}{p} \forbid{A}{P_1}} &
        \nombreRegla{forb2} & \displaystyle
        \frac{P \tranp{\checkmark}{p} \nil}{\forbid{A}{P}
                \tranp{\checkmark}{p} \nil}  \\
        %      \nombreRegla{forb3} & \displaystyle
        %     \frac{P\tran{\feature{A}}P_2 \tran{\feature{F}} P_1}{\forbid{A}{P}
        %       \tran{\feature{B}} \forbid{A}{P_1}},\ \feature{B}\neq\feature{A} &
        %      \nombreRegla{forb4} & \displaystyle
        %     \frac{P\tran{\feature{A}}P_2 \tran{\feature{\checkmark}} P_1}{\forbid{A}{P}
        %       \tran{\checkmark} \nil}\\
        %
        %
        %
        \nombreRegla{mand1} &  \displaystyle\frac{P\tranp{\checkmark}{p} \nil}{\mandatory{A}{P}
                \tranp{\feature{A}}{p} \checkmark}  &
        \nombreRegla{mand2} &  \displaystyle\frac{P\tranp{\feature{A}}p P_1}{\mandatory{A}{P}\tranp{\feature{A}}p P_1} \\
        \nombreRegla{mand3} &  \displaystyle\frac{P\tranp{\feature{B}}p
                P_1,\ \feature{A}\neq\feature{B}}{\mandatory{A}{P}\tranp{\feature{B}}p \mandatory{A}{P_1}}
        \\
        \multicolumn{4}{c}{\feature{A},\feature{B},\feature{C}\in\calF,\ a\in\calF\cup\{\checkmark\}}

        \end{array}
        $}

        \noindent

        \linefigure

        \caption{\fodaPAp\ operational semantics.  \label{fig:sos-rules}}
\end{figure*}

In Figure~\ref{fig:sos-rules} we present the set of rules formally defining  the operational behavior of
\fodaPAp. These rules essentially coincide with the ones corresponding to
\fodaPA~\cite{acl13}, but with the addition of probabilities. Next we focus
on the explanation of the role of probabilities. Rules
$\nombreRegla{tick}$ and $\nombreRegla{feat}$
show the corresponding feature with probability 1.
%
Rules  $\nombreRegla{ofeat1}$ and $\nombreRegla{ofeat2}$ deal with the
probabilistic optional feature. The feature can be chosen with probability
$p$ and can be rejected with probability  $1-p$. Let us note that both probabilities
are not null.
%
Rules $\nombreRegla{cho1}$ and $\nombreRegla{cho2}$ define the
behavior of the probabilistic choice operator. The left branch is
selected with probability~$p$ and the right one with probability~$1-p$.
%
It is important to note that the rules for the conjunction operator,
$\nombreRegla{con1}$,
$\nombreRegla{con2}$,
$\nombreRegla{con4}$ and
$\nombreRegla{con5}$,
equitably distribute the probability between both
branches, that is, $\frac{1}{2}$. We have preferred to use a simple definition of this operator, but it is easy to replace it by a more involved version of a probabilistic conjunction operator~\cite{ahk98}.
%
Rule $\nombreRegla{con3}$ requires that both branches agree on the
termination of a product. Figures~\ref{example:op1}
and~\ref{example:op2} contain some examples of the operational semantics.
%

\input{ex_operational}

We use \emph{multisets} of transitions to consider different occurrences of the same transition. Thus, if a transition can be derived in several ways, then each derivation generates a different
instance of this transition~\cite{h96}. For example, let us consider the
term
$P=\feature{A};\checkmark \choice_{\frac12} \feature{A};\checkmark$. If we were not careful, then we would have
the transition $P\tranp{\feature{A}}{\frac12}\checkmark$ only once, while we
should have this transition twice. So, if a transition can be derived in
several ways, then we consider that each derivation generates a
different instance. In particular, we will later consider multisets of computations as well.
%
We will use the delimiters~$\lbag$ and~$\rbag$ to denote
multisets and $\uplus$ to denote the union of multisets.

The following result, whose proof is immediate, shows that successful termination leads to $\nil$.

\blem\label{lem:check}
Let $P,Q\in\fodaPAp$ and $p\in(0,1]$. We have $P\tranp{\checkmark}{p}{Q}$ if and only if $Q=\nil$.
\elem

Next we present some notions associated with the composition of consecutive transitions.

\bdfn\label{def:trtrantions} Let $P,Q\in\fodaPAp$. We write  $P\vtranp{s}{p}Q$ if there exists a sequence of consecutive transitions
\begin{displaymath}
    P=P_0\tranp{a_1}{p_1}P_1\tranp{a_2}{p_2}P_2\cdots P_{n-1}\tranp{a_n}{p_n} P_n=Q
\end{displaymath}
where $n\geq 0$, $s=a_1a_2\cdots a_n$ and $p=p_1\cdot p_2\cdot \cdots
p_{n}$. We say that $s$ is a trace of~$P$.

Let $s\in\calF^*$ be a trace of $P$. We define the product
$\product{s}\subseteq\calF$ as the set consisting of all features belonging to
$s$.

Let $P\in\fodaPAp$. We define the set of probabilistic products of $P$, denoted by $\prodp(P)$, as the set
\begin{displaymath}
 \prodp(P) = \{(pr,p)\ |\ p>0 \wedge p=\sum\lbag q\ |\
  P\vtranp{s\checkmark}{q} Q \y \product{s}=pr \rbag\}
\end{displaymath}
\item We define the total probability of $P$, denoted by $\ham(P)$, as the value $\sum\lbag p\ |\ \exists pr: (pr,p)\in\prodp(P)\rbag$. In addition, we define $\waste(P) = 1-\ham(P)$.
\edfn

The following result shows some properties, concerning probabilities, of the operational semantics. In particular, we have that the probability of (sequences of) transitions is greater than zero and that the probabilities of products belong to $[0,1]$.

\blem\label{lem:sum:prob}
  Let  $P,\ Q\in\fodaPAp$.We have the following results.
  \begin{enumerate}
  \item If $P\tranp{\feature{A}}{p}Q$ then $p\in(0,1]$.
        If $P\vtranp{s}{p}Q$ then $p\in(0,1]$.
  \item
    $\sum \lbag p\, |\ \exists \feature{A}\in\calF,\ Q\in\fodaPAp:\
    P\tranp{\feature{A}}{p}Q \rbag\in[0,1]$.
  \item
    $\sum \lbag p\, |\ \exists s\in\calF^*,\ Q\in\fodaPAp:\
    P\tranp{s\checkmark}{p}Q \rbag\in[0,1]$.
  \item $\ham(P)\in [0,1]$.
  \end{enumerate}
\elem


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
