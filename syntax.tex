\section{$\fodaPAp$: syntax and semantics}
\label{sec:stat:sintaxMain}
In this section we introduce our language. In addition to present its syntax, we define an operational semantics and a denotational semantics. In the next section we will show the equivalence between these two semantic frameworks.


\subsection{Syntax and operational semantics}
\label{sec:stat:sintax}
Following our previous work~\cite{acl13,clc16}, we will consider a
set of features. We denote this set by $\calF$ and consider that $\feature{A}, \feature{B},
\feature{C}$ range over $\calF$. We have a special feature
$\checkmark\not\in\calF$ to mark the end  of a product. We consider a syntax similar to
\fodaPA, where probabilities are introduced both in the choice operator $P \choice_{p} Q $ and in
the optional feature operator $\ofeature{A};_{p} P$. We do not allow
\emph{degenerated} probabilities, that is, for all probability $p$ we have $0< p<1$.

The operators syntax is defined as in~\cite{acl13,clc16}.
In order to define the syntax,
we need to fix the set of \emph{features}.
From now on $\calF$ denotes a finite set  of features
and  \feature{A}, \feature{B}, \feature{C}\dots\ denote isolated features.


In this research article, like in the previous definition of SPLA~\cite{acl13,clc16},
we define and express formally that even if a feature is
represented with a mandatory relationship in the feature model,
it might not be computed in the final set or trace of valid products.
This is because of the cross tree constraints presented in the formal
representation of \fodaPA, more in specific, the \nombreRegla{excl2} and \nombreRegla{excl3} rules.
These rules, in the case of computing them, those features will be marked for hiding,
this is thanks rules \nombreRegla{hid1} and \nombreRegla{hid2} from
Figure~\ref{fig:oper-hid}, making the features
disappear in the valid products set after computing the feature model.



In the syntax of the language there are two sets of operators.
On the one hand there are \emph{main operators}, such as $\cdot\choice\cdot$, $\cdot\paral\cdot$, $\feature{A};\cdot$, $\ofeature{A};\cdot$,
$\require{A}{B}{\cdot}$, $\exclude{A}{B}{\cdot}$,
that directly correspond to relationships in \FODA\ diagrams.
On the other hand, we have \emph{auxiliary operators}, such as $\nil$, $\checkmark$, $\forbid{A}{\cdot}$, $\mandatory{A}{\cdot}$,
which we need to define the semantics of the language.


\bdfn
\label{dfn:syntax}
A \emph{probabilitistc SPL} is a term generated by the following
BNF expression:
$$
\begin{array}{ll}
P::=& \checkmark \barra \nil \barra \feature{A};P \barra
\ofeature{A};_{p} P \barra P \choice_{p} P \barra P \paral P \barra
\\
& \exclude{A}{B}{P}\barra  \require{A}{B}{P}\barra  \forbid{A}{P}\barra  \mandatory{A}{P}\\
\end{array}
$$
\noindent
where $\feature{A},\feature{B} \in \calF$ and $p\in(0,1)$. The set of terms of the
algebra will be denoted by  $\fodaPAp$.
\edfn



In order to avoid writing too many parentheses in the terms, we
assume left-associativity in binary operators and  the
following precedence in the operators (from higher to lower priority):
$\feature{A};P$, $\ofeature{A};_{p} P$, $ P \choice_{p} Q$, $P\paral Q$,
$\exclude{A}{B}{P}$, $\require{A}{B}{P}$,
$\require{A}{B}{P}$,  $\forbid{A}{P}$, and $\mandatory{A}{P}$.
In~\cite{acl13,clc16} we demonstrated that
the binary
operators are commutative and associative.
As a result, the
\emph{choose-one} operator ($\cdot\choice_{p}\cdot$) and the
\emph{conjunction} operator ($\cdot\paral\cdot$) are $n$-ary operators
instead of just binary operators.


% The Extended BNF in Definition~\ref{dfn:syntax} says
% that a term of \fodaPA\ is
% a sequence of operators and features.

There are two terminal symbols in
the language, $\nil$ and $\checkmark$,
we need them to define the semantics of the language.
%, see
%The first semantics where we will use them will be an \emph{operational} semantics.
Let us note that the products of a term in \fodaPA\ will be computed following some rules.
The computation will finish when no further steps are allowed.
This fact is represented by the $\nil$ symbol.
We will introduce rules to compute a product, with this computation
finishing when no further steps are required, a situation represented by~\nil.
During the computation of an \fodaPAp\ term,  we have
to represent the situation in which a \emph{valid product}
of the term has been computed.
This fact is represented by the $\checkmark$ symbol.

The operators $\feature{A};P$ and $\ofeature{A}_{p};P$ add the feature $\feature{A}$ to any product that can be obtained
from $P$. The operator $\feature{A};P$ indicates that $\feature{A}$ is mandatory while $\ofeature{A}_{p};P$ indicates
that $\feature{A}$ is optional and computed with probability $p$.
There are two binary operators: $P \choice_{p} Q$ and $P\paral Q$. The
first one represents a probabilistic choice. It represents a point in
the product line between two options. In this probabilistic framework,
the choice is quantified with a probability \(p\): the probability of
choosing the left hand side is \(p\) and the probability of choosing
the right hand side is \(1-p\). The operator $P\paral Q$ is the
conjunction, intuitively it combines the products of both subterms
\(P\) and \(Q\) by accumulating the features.

\begin{example}
  Let us consider the term
  $P=\feature{A};\checkmark\choice_{\frac{1}{3}}\fB;\checkmark$. This
  term will produce two products: $\{\fA\}$ with probability
  \(\frac{1}{3}\)
  and \(\{\fB\}\) with probability \(\frac{2}{3}\).
  Let us consider $Q=\fC;\ofeature{D}_{\frac{1}{5}};\checkmark$. This term will
  produce
  two products: \(\{\fC\}\) with probability \(\frac{4}{5}\) and
  \(\{\fC,\fD\}\) with probability \(\frac{1}{5}\).
  Then \(P\paral Q\) will produce the following products:
  \(\{\fA,\fC\}\) with probability \(\frac{4}{15}\),
  \(\{\fA,\fC,\fD\}\) with probability \(\frac{1}{15}\),
  \(\{\fB,\fC\}\) with probability \(\frac{8}{15}\), and
  \(\{\fA,\fC,\fD\}\) with probability \(\frac{2}{15}\).

\end{example}

The constraints are easily represented in \fodaPAp.
The operator $\require{A}{B}{P}$ represents the \emph{require}
constraint in \FODA.
The operator $\exclude{A}{B}{P}$ represents the \emph{exclusion}
constraint in \FODA.

    \bex
      The term $\require{A}{B}{\feature{A};\checkmark}$ has only one valid
      product $\{\feature{A}, \feature{B}\}$ with  probability 1.

      Let us consider
      $P=\feature{A};(\feature{B};\checkmark\choice_{\frac{1}{3}}\feature{C};\checkmark)$.
      This
      term has two valid products: The first one
      $\{\feature{A},\feature{B}\}$ with probability $\frac{1}{3}$,
      and $\{\feature{A}, \feature{C}\}$ with probability $\frac{2}{3}$.

      If we add to the previous term the following constraint
      $\exclude{A}{B}{P}$, then this new term  has only one
      $\{\feature{A},\feature{C}\}$ with  with probability
      $\frac{2}{3}$.
      This term has probability $\frac{1}{3}$ of producing nothing.
    \eex


The operator $\mandatory{A}{P}$ is necessary to define the behavior
of the $\require{A}{B}{P}$ operator:
when we compute the products of the term $\require{A}{B}{P}$, we have
to take into account whether  product  \feature{A} has been produced or not.
In the case it has been produced, we have to annotate
that we need to produce \feature{B} in the future.
The operator $\mandatory{B}{P}$  is used for this purpose.
The same happens with  the operator $\forbid{B}{P}$.
% is necessary to define the semantics of the $\exclude{A}{B}{P}$.
When we  compute the products of $\exclude{A}{B}{P}$,
if the feature \feature{A} is computed
at some point, we  annotate
that \feature{B} must not be included. The operator $\forbid{B}{P}$ indicates
that product \feature{B} is forbidden.






























%\todo{Hay que explicar los operadores probabilísticos $P \choice_{p}
%       Q$ y $\ofeature{A};_{p} P$ y la razón por la que el resto no
%       necesita probabilidades.}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
