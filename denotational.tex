\subsection{Denotational Semantics}
\label{sec:stat:den}

Next we define a denotational semantics for the terms of our language. The main characteristic of the semantic domain is that we consider products (set of features) with probability such that the sum of all the probabilities associated with products belongs to the interval $(0,1]$. First, we
precisely define the members of the semantic domain.

%\todo{Explicar el modelo con mÃ¡s detalle,  y el motivo por el que se necesitan multiconjnutos}

\bdfn\label{def:den:pr}
We define the semantic domain $\calM$ as the largest set $\calM\subseteq\calP(\calP(\calF)\times
  (0,1]))$ such that if $A\in\calM$ then the following
  conditions hold:
  \begin{itemize}
  \item If $(P,q)\in A$ and $(P,r)\in A$ then $q=r$.
  \item $0\leq \sum \lbag q \ | \ \exists P: (P,q)\in A\rbag \leq 1$.
  \end{itemize}
%\edfn

%\begin{itemize}
%\item The multisets in will appear in the operational semantics.
%\item We need to convert these multisets into sets of the model. It is
%  possible if the conditions of Proposition~\ref{prop:pr:accum} hold.
%\end{itemize}

%\bdfn
Let $M$ be a multiset  with elements in the set $\calP(\calF)\times [0,1]$.
We define the operator $\accum$ as follows:
  $$\accum(M) = \left\{(P,p)\ \left| \ p=\sum_{(P,q)\in M}q \wedge p>0\right. \right\}$$
\edfn

Even though the elements of the semantic domain are sets of pairs (product, probability), with at most one occurrence of a given product, we will use multisets as auxiliary elements in our semantic functions. Then, the function $\accum(M)$ will \emph{flatten} them to become sets.
The following result is immediate.

\bprop\label{prop:pr:accum}
 Let $M$ be a multiset with elements in the set $\calP(\calF)\times
 [0,1]$. If $1\geq\sum\lbag q\ |\ (P,q)\in M\rbag$
 then $\accum(M)\in\calM$.
\eprop


Next we define the operators of the denotational semantics (called denotational operators). As we have said before, multisets
meeting the conditions of the previous result appear when
defining these operators. For instance, the prefix operator
$\semden{\fA;}(M)$ should add feature $\fA$ to any product in $M$. Let us
suppose that
$M=\{
   (\{\fB,\fA\},\frac{1}{2}),
   (\{\fB\},\frac{1}{2})\}$.
If we add $\fA$ to the products of $M$ then we obtain the product
$\{\fA,\fB\}$ twice, having probability $\frac{1}{2}$ associated with each occurrence. So we
need to apply the function $\accum$ to accumulate both probabilities
and obtain a single product with probability~$1$.


\bdfn\label{def:semantic:operators}
  Let $M,M_1,M_2\in\calM$, $\fA,\fB\in\calF$ and $p\in(0,1]$. For any operator appearing in
  Definition~\ref{sec:stat:sintax} we define its denotational operator
  as follows:
  \begin{itemize}

  \item $\semdenp{\nil}=\emptyset$

  \item $\semdenp{\checkmark}=\{(\emptyset,1)\}$

  \item
    $\semdenp{\feature{A};\cdot}(M)=
      \accum\bigl(\lbag(\{\feature{A}\}\cup P,p)\ |\ (P,p)\in M\rbag\bigr)
      % \accum\bigl(
      %    \{ (\{\feature{A}\} \cup P,p ) |\   (P,p) \in M\}\bigr)
         $

  \item
    $\semdenp{\ofeature{A};_{p}\cdot}(M)=
                \accum\bigl(\lbag(\emptyset , 1-p )\rbag\uplus\lbag (\{\feature{A}\}\cup P, p\cdot q ) \ |\ (P,q) \in M\rbag\bigr)$

  \item
    $\semdenp{\cdot\choice_{p}\cdot}(M_{1},M_{2})=\accum
    \left(\begin{array}{l}
    \lbag(P,p\cdot q  ) \ |\ (P,q) \in M_{1}\rbag \uplus\\
    \lbag(Q, (1-p)\cdot q  ) \ |\ (Q,q) \in M_{2}\rbag
    \end{array}\right) $
  \item
    $
        \semdenp{\cdot\paral\cdot}(M_{1},M_{2})= \accum\Bigl(
                \lbag (P\cup Q, p\cdot q)  |\ (P,p) \in M_{1},\ (Q,q) \in M_{2}\rbag\Bigr)
    $

  \item
    $\semdenp{\require{A}{B}{\cdot}}(M)=\accum\left(\begin{array}{l}
      \lbag\bigl(P,p\bigr)\ |\  (P,p)\in M, \feature{A}\not\in P\rbag\ \uplus\\
      \lbag\bigl(\{\feature{B}\}\cup P ,p\bigr)\ |\ (P,p)\in M, \feature{A}\in P\rbag \\
      \end{array}\right)$

  \item
    $\semdenp{\exclude{A}{B}{\cdot}}(M)=\begin{array}[t]{l}
      \{(P,p)\ |\ (P,p)\in M, \feature{A}\not\in P\}\cup\\
      \{(P,p)\ |\ (P,p)\in M, \feature{B}\not\in P\}
      \end{array}$

    \item $\semdenp{\mandatory{A}{\cdot}}(M) = \semdenp{\feature{A};{\cdot}}(M)$

    \item
      $\semdenp{\forbid{A}{\cdot}}(M) = \{(P,p)\ |\ (P, p) \in M, \feature{A}\not\in P      \}$

  \end{itemize}
\edfn


The denotational semantics for the prefix operator
$\semdenp{\feature{A};\cdot}(M)$
and the denotational semantics for the operator
$\semdenp{\require{A}{B}{\cdot}}(M)$
behave in the same way if the feature is added
to the products. In the first case the feature $\feature{A}$ is mandatory
so it will be added, and in the second case the feature $\feature{B}$ is required
if the feature $\feature{A}$ is already included in the product.

It is easy to check that all the multisets appearing in the previous
definition meet the conditions of Proposition~\ref{prop:pr:accum}. So,
the operators are actually well defined. This is formalized in the
following result.
\bprop\label{prp:domain:prob}
  Let  $M,M_{1}, M_{2}\in\calM$,
  $p\in(0,1]$ be a probability, and
  $\feature{A},\feature{B}\in\calF$ be features. We have:
\begin{multicols}{2}
        \begin{itemize}
                \item $\semdenp{\feature{A};\cdot}(M)\in\calM$
                \item $\semdenp{\ofeature{A};_{p}\cdot}(M)\in\calM$
                \item $\semdenp{\cdot\choice_{p}\cdot}(M_{1},M_{2})\in\calM$
                \item $\semdenp{\cdot\paral\cdot}(M_{1},M_{2})\in\calM$
                \item $\semdenp{\require{A}{B}{\cdot}}(M)\in\calM$
                \item $\semdenp{\exclude{A}{B}{\cdot}}(M)\in\calM$
                \item $\semdenp{\mandatory{A}{\cdot}}(M)\in\calM$
                \item $\semdenp{\forbid{A}{\cdot}}(M)\in\calM$
        \end{itemize}
\end{multicols}
%$$ \begin{array}{lllll}
%\bullet\ \semdenp{\feature{A};\cdot}(M)\in\calM & &
%\bullet\ \semdenp{\cdot\paral\cdot}(M_{1},M_{2})\in\calM& &
%\bullet\ \semdenp{\mandatory{A}{\cdot}}(M)\in\calM\\
%\bullet\ \semdenp{\ofeature{A};_{r}\cdot}(M)\in\calM& &
%\bullet\ \semdenp{\require{A}{B}{\cdot}}(M)\in\calM& &
%\bullet\ \semdenp{\forbid{A}{\cdot}}(M)\in\calM\\
%\bullet\ \semdenp{\cdot\choice_{r}\cdot}(M_{1},M_{2})\in\calM& &
%\bullet\ \semdenp{\exclude{A}{B}{\cdot}}(M)\in\calM
%  \end{array}$$
\eprop





%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% ispell-local-dictionary: "english"
%%% End:
